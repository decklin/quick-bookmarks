<!DOCTYPE html>
<html>
<head>
<title>Quick Bookmarks</title>
<script>
var ctrl = false;
var keyD = function(e) {
    if (e.which == 17) ctrl = true;
}
var keyU = function(e) {
    if (e.which == 17) ctrl = false;
}
function mouseUP(e) {
    if (e.which == 2) {
        newTab(this.href);
    } else if (e.which==1) {
        if (ctrl)
            newTab(this.href);
        else
            sameTab(this.href);
    }
}

function newTab(u) {
    chrome.tabs.create({'url': u}, function() {});
}
function sameTab(u) {
    chrome.tabs.getSelected(null, function(t) {
        if (u.substr(0, 11) == 'javascript:')
            chrome.tabs.executeScript(t.id, {'code': u.substr(11)});
        else
            chrome.tabs.update(t.id, {'url': u});
        window.close();
    });
}

function getLabel(e) {
  var text = e.title.substring(0, 20);
  if (e.title != text) {
    text += '..';
  }
  return text;
}

function listImg(a) {
    var src = (a.href.substr(0, 11) == 'javascript:') ? 'stock-script.png' :
        'http://www.google.com/s2/favicons?domain=' + a.hostname;
    return '<img class="favicon" src="' + src + '" />';
}

function appendList(t) {
    var l = document.getElementById("blist");
    for (var i=0; i<t.length; i++) {
        if (t[i].url) {
            var s = document.createElement("a");
            s.href = t[i].url;
            s.innerHTML = listImg(s) + ' ' + getLabel(t[i]);
            s.onmouseup = mouseUP;
            s.title = t[i].title;
            l.appendChild(s);
        }
    }
    l.focus();
}

function init() {
    var root;
    try {
        if ((root = localStorage['qb_root'])) throw true;
        else throw false;
    }
    catch (e) {
        if (e == false) {
            newTab(chrome.extension.getURL('options.html'));
            window.close();
        }
    }
    chrome.bookmarks.getChildren(root, appendList);
}
</script>
<style>
body {
    margin: 0 0 0 0;
    padding: 0px;
}
a {
    color: #093E41;
    margin: 0 2px 0 0;
    text-decoration: none;
    display: block;
    cursor: pointer;
    padding: 1px 5px 1px 5px;
    font-family: verdana;
    font-size: 10pt;
    -webkit-border-radius: 5px;
}
.favicon {
    width: 16px;
    height: 16px;
    vertical-align: middle;
    margin-top: -3px;
}
a:hover {
    background: -webkit-gradient(linear, left top, left bottom,
                                 from(#7C24CB), to(#6619AA));
    color: #ffffff;
    -webkit-box-shadow: 1px 1px 1px #000000;
}
div {
    min-width: 170px;
}
</style>

</head>
<body onload="init();" onkeydown="keyD(event);" onkeyup="keyU(event);">
<div id="blist" />
</body>
</html>
